{### Extends #}
{% extends '_layouts/main.twig' %}

{### Blocks #}
{% block content %}
    <section class="container">
        <h1 class="text-white text-5xl md:text-7xl xl:text-8xl">Blog</h1>
    </section>

    {# Kategorien-Filter #}
    {% set allCategories = craft.categories.group('blogCategories').all() %}
    {% set activeCategory = craft.app.request.getParam('kategorie') %}

    {% if allCategories|length %}
        <section class="container mt-8">
            <div class="flex flex-wrap gap-2">
                <a href="{{ url('blog') }}"
                   class="px-3 py-1 {{ not activeCategory ? 'bg-pink text-white' : 'bg-white/10 text-white hover:bg-pink' }} text-sm rounded-full transition-colors">
                    Alle
                </a>
                {% for category in allCategories %}
                    <a href="{{ url('blog', { kategorie: category.slug }) }}"
                       class="px-3 py-1 {{ activeCategory == category.slug ? 'bg-pink text-white' : 'bg-white/10 text-white hover:bg-pink' }} text-sm rounded-full transition-colors">
                        {{ category.title }}
                    </a>
                {% endfor %}
            </div>
        </section>
    {% endif %}

    {# Blog-Beitr√§ge #}
    {% set query = craft.entries.section('blog').orderBy('postDate desc') %}

    {% if activeCategory %}
        {% set filterCategory = craft.categories.group('blogCategories').slug(activeCategory).one() %}
        {% if filterCategory %}
            {% set query = query.relatedTo(filterCategory) %}
        {% endif %}
    {% endif %}

    {% set posts = query.all() %}

    {% if posts|length %}
        <section class="container mt-12">
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8">
                {% for post in posts %}
                    <a href="{{ post.url }}" class="group block bg-white/5 rounded-lg overflow-hidden hover:bg-white/10 transition-colors">
                        {% if post.image|length %}
                            <div class="aspect-video overflow-hidden">
                                <img src="{{ post.image.one().url }}"
                                     alt="{{ post.title }}"
                                     class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                            </div>
                        {% endif %}
                        <div class="p-6">
                            {% set postCategories = post.blogCategories.all() %}
                            {% if postCategories|length %}
                                <div class="flex flex-wrap gap-2 mb-3">
                                    {% for category in postCategories %}
                                        <span class="px-2 py-0.5 bg-white/10 text-white/60 text-xs rounded-full">
                                            {{ category.title }}
                                        </span>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <h2 class="text-white text-xl font-bold">{{ post.title }}</h2>
                            <div class="text-white/60 text-sm mt-2">{{ post.postDate|date('d.m.Y') }}</div>
                        </div>
                    </a>
                {% endfor %}
            </div>
        </section>
    {% else %}
        <section class="container mt-12">
            <p class="text-white/60">Noch keine Blog-Beitr&auml;ge vorhanden.</p>
        </section>
    {% endif %}
{% endblock %}
